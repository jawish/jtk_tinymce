/**
 * plugin.js
 *
 * Thaana keyboard handler for TinyMCE WYSIWYG editor using JTK library.
 * @author  Jawish Hameed <jaa@jawish.org>
 */
tinymce.PluginManager.add("jtk",function(n){function e(e){var a=null,t=n.settings.jtk_language_guess_threshold||o,i=n.settings.jtk_language_guess_regexes||g,r=n.settings.jtk_languages||u;return tinymce.each(i,function(n,u){var o=e.match(n),g=(o?o.length:0)/e.length;return g>=t?(a=u,!1):void 0}),r[a]||null}function a(){return function(){var a=this;n.on("nodeChange",function(){var u=n.selection.getRng();u.expand("word");var o=e(u.toString());return o&&(t(o),a.value(o)),!0})}}function t(n){n.control&&(n=n.control.value()),n&&(i=n)}var u=["English","Thaana","Arabic"],o=.8,g=[/[\u0000-\u007F\u0080-\u00FF\u0100-\u017F\u0180-\u024F\u0250-\u02AF]/g,/[\u0780-\u07BF]/g,/[\u0600-\u06FF\u0750-\u077F\uFB50-\uFDFF\uFE70-\uFEFF]/g],i=n.settings.jtk_active_language||u[0];"undefined"==typeof thaanaKeyboard&&console.log("JTK for TinyMCE needs JTK to be available and loaded before TinyMCE."),n.on("keypress",function(e){"Thaana"==i&&(thaanaKeyboard.value="",thaanaKeyboard.handleKey(e),n.insertContent(thaanaKeyboard.value))}),n.addCommand("jtkSetActiveLanguage",t),n.addButton("jtklanguage",function(){var e=[],o=n.settings.jtk_languages||u;return tinymce.each(o,function(n){e.push({text:n,value:n})}),{type:"listbox",text:"Keyboard",tooltip:"Keyboard Language",values:e,fixedWidth:!0,onPostRender:a(e),onclick:t}})});